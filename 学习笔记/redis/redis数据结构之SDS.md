### redis中常见的数据结构



#### SDS（简单动态字符串）

![](D:\mdimage\TIM截图20200307201754.png)



#### SDS对比C字符串

1. **SDS常数复杂度获取字符串的长度**。

2. **SDS可以防止缓冲区溢出**。

   传统的C字符串，在使用字符串之前需要为它分配足够的空间，如果程序员忘记分配则会导致内存溢出。

   SDS发现空间不足的时候会自动分配，不会导致缓冲区溢出。

3. **SDS减少修改字符串带来的内存重分配次数**。

   传统的C字符串，每一次修改字符串都会导致内存重分配（增加或者减少）。内存重分配涉及到系统调用，他是一个比较耗时的操作。

   Redis出于对速度的考虑，通过**空间预分配**和**惰性释放**两种策略减少内存重分配的次数。

   **空间预分配**：

   如果修改SDS之后，SDS的长度小于1MB，那么Redis会为它额外分配等大小的内存空间。（比如，一个SDS修改之后大小为13KB，那么Redis还会为它预留13KB大小空间），如果SDS修改之后的大小大于1MB那么，redis还会为它分配额外1MB的内存空间。

   **惰性空间释放**

   当程序需要缩短SDS字符串长度的时候，redis不会立即回收SDS多余的内存空间，而是将多余的空间保存在free中，等待需要用的时候再拿出来直接用，同时redis也提供了API可以直接释放这部分空间。

4. **SDS是二进制安全的**

   传统C字符串的字符必须符合某种编码（如ASCII）。并且字符串末尾以\0结束，所以不能存储以空格分开的文本，也不能存储图片等。SDS使用二进制来存储数据，所以这也是buf被称为**字节数组**的原因。

   ![](D:\mdimage\TIM截图20200307203956.png)

    

    
