

### 行锁

1.Record Lock ：单个行记录上的锁

2.Gap Lock：间隙锁，锁定一个范围但是不包含锁本身

3.Next-Key Lock：前两种锁的结合，锁定一个范围，且锁定记录本身。

**Record Lock 总是锁定索引记录。**



### 幻读

事务1

select * from user where id = 1;

在事务1查询结束之后，事务2插入了id=1的数据

insert into User(id) values(1);

然后事务1去插入一条数据，结果报主键冲突

幻读主要是insert delete操作



### 如何解决幻读

将两行记录间的空隙加上锁，阻止新记录的插入；这个锁称为**间隙锁**。 



### 脏读

事务隔离级别为：Read Uncommit

一个事务读取了另一个事务尚**未提交**的数据。违背了数据库的隔离性。



### 不可重复读

事务隔离级别为：Read Commit

在一个事务内部读取同一数据集合。在这个事务还没有结束，另外一个事务访问这个集合，并且修改数据（主要是update）。所以第一个事务先后读取到的数据不一致。



### 幻读和不可重复读的区别

幻读是在事务A中读取了事务B对数据的insert和delete操作（此时事务B已经提交），解决办法，间隙锁。

不可重复读是在事务A中读取了事务B对数据的update操作（此时事务B已经提交），解决办法，对数据加行锁（X锁 for update）。

 

 

 

 

 